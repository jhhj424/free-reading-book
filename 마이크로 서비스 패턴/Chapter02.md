# 2장 분해 전략

포트와 어댑터란?

- 포트: 인터페이스, 예를 들면 클래스의 메서드 시그니처나 Java의 인터페이스
  - 서비스, 리포지터리 인터페이스, 메시징 인터페이스 ...
- 어댑터: 디자인 패턴에도 있듯이 클라이언트에 제공해야 할 인터페이스를 따르면서도 내부 구현은 서버의 인터페이스로 위임하는 것
  - 컨트롤러, 컨슈머, DAO, 프로듀서 ...
- 포트는 독립적인 응답을 제공하고 어댑터에서 외부에 필요한 형식으로 가공해서 전달함
- 라인 기술 블로그: [https://engineering.linecorp.com/ko/blog/port-and-adapter-architecture/](https://engineering.linecorp.com/ko/blog/port-and-adapter-architecture/)

모놀리식 아키텍처

- 애플리케이션을 실행/배포 가능한 단일 컴포넌트로 구성한다.

마이크로서비스 아키텍처

- 애플리케이션을 느슨하게 결합된, 독립적으로 배포 가능한 여러 서비스로 구성한다.
- 핵심 제약 조건: 서비스를 느슨하게 결합한다.

서비스란?

- 어떤 기능이 구현되어 단독 배포가 가능한 소프트웨어 컴포넌트
- 핵심 요건: 자체 API를 갖고 독립적으로 배포가 가능하다.

아키텍처를 정의하는 방법

1. 애플리케이션 요건을 핵심 요청으로 추출
2. 어떻게 여러 서비스로 분해할지 결정
3. 서비스별로 API를 정의

서비스를 분해하는 과정에서의 장애물

1. 네트워크 지연 - 서비스 간 왕복이 너무 잦아 실제로 분해할 수 없는 경우도 있음
2. 서비스 간 동기 통신으로 인해 가용성 저하 - 해법: 자기 완비형 서비스(3장)
3. 여러 서비스에 걸쳐 데이터 일관성 만족 - 해법: 사가 패턴(4장)
4. 애플리케이션 도처에 숨어 있는 만능 클래스 - 해법: DDD

시스템 작업 식별 2단계 프로세스

1. 핵심 클래스로 구성된 고수준의 도메인 모델을 생성
2. 시스템 작업 식별 후 그 동작을 도메인 모델 관점에서 기술

도메인 모델은 주로 사용자 스토리의 명사에서 도출한다.

- ex) Order, Restaurant, Delivery ...

시스템 작업은 주로 동사에서 도출한다.

- ex) 생성된다. 연관된다. 변경된다. 배정한다. 등 ...
- 시스템 커맨드를 식별하려면 사용자 스토리/시나리오에 포함된 동사를 먼저 분석한다.

서비스 정의 패턴 두가지

- 비즈니스 능력 패턴별 분해 - 비즈니스 능력에 따라 서비스를 정의한다.
  - ex) 공급자 관리, 소비자 관리, 주문 접수 및 이행, 회계 ...
- 하위 도메인 패턴별 분해 - DDD(Domain-driven-Design) 하위 도메인별로 서비스를 정의한다.
  - ex) 주문 접수 하위 도메인, 배달 하위 도메인, 주방 하위 도메인, 회계 하위 도메인 ...

### 정리

- 아키텍처는 애플리케이션 개발 속도에 직접 영향을 주는 갖가지 '~성(예: 관리성, 테스트성, 배포성)'을 좌우함
- 마이크로서비스 아키텍처는 애플리케이션의 관리성, 테스트성, 배포성을 높이는 아키텍처 스타일
- 마이크로서비스는 기술적 관심사보다 비즈니스 능력, 하위 도메인 등 비즈니스 관심사 위주로 구성
- 서비스를 분해하는 패턴은 크게 두가지
  - 비즈니스 능력에 따른 분해: 비즈니스 아키텍처 기반
  - 하위 도메인에 따른 분해: DDD 개념 기반
- DDD를 적용하고 서비스마다 도메인 모델을 따로 설계하면, 의존 관계가 뒤엉켜 분해를 가로막는 만능 클래스를 제거할 수 있다.
